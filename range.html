
<!DOCTYPE html>
<html>
   <head>
   <meta charset="utf-8">
      <title>Electric Car Range</title>
    </head>
	<script src="https://d3js.org/d3.v4.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <body style = "font-family:verdana;font-size:20px;" id = "tooltipBody">
		<div class="right" style="padding-left:20px;position:relative;font-size:36px;">
		
		    <p>
			 You want your electric car to have...
		    </p>
		</div>
    
	<a href="https://maxahoy.github.io/electricVehicleCompare2021/performance.html";onClick="currentChart = performanceButton();console.log('chartchoice = ' + currentChart);" style="cursor: pointer; cursor: hand; font-size:20px;color:blue;" title="Click me to see the Performance chart">. . . the best Performance</a><br>
	<a style="font-size:20px;color:black;" title = "Click me to see the Range chart">. . .  the longest Range</a><br>
	<a href="https://maxahoy.github.io/electricVehicleCompare2021/charging.html";onClick="currentChart = chargingButton();console.log('chartchoice = ' + currentChart);" style="cursor: pointer; cursor: hand; font-size:20px;color:blue;" title = "Click me to see the Charging chart">  . . . the fastest Charging</a><br>
	<p></p>
	<p>Select your minimum preferred EV range, in kilometers.</p>
	<input id="rangeSlider" title="What is your minimum range" style="position:relative;top:2px;" type="range" min="0" max="1000" step="10">

   </select>
	<p><P>
	<svg id="range">
	
	</svg>
	
	<script>
	
	
		/*
	##TODO:
Import the json data - done
Build the scatter plot
In the update loop as well
No transitions necessary... but maybe if you feel like it


	*/
	//for development url: https://raw.githack.com/Maxahoy/electricVehicleCompare2021/main/ev-data.json
		//for production: https://rawcdn.githack.com/Maxahoy/electricVehicleCompare2021/d20daec3b06eec3013a8fec48acae39e6c528447/ev-data.json
	var dataURL = "https://raw.githack.com/Maxahoy/electricVehicleCompare2021/main/ev-data.json"

	var margin = {top : 30, right: 100, bottom: 100, left: 100},
		width = 1400 - margin.left - margin.right,
		height = 300 - margin.top - margin.bottom;
			
		
	
	//select the svg for this page	
	var rangeSVG = d3.select("#range")
		.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
		.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		
	//tooltip (TODO)
	
	//x axis
	/*var x = d3.scaleL()
		.range([0, width])
		.padding(0.03);
	var xAxis = rangeSVG.append("g")  //copied from the performance one...
		.attr("transform", "translate(0," + height + ")")*/
		
		
	var x = d3.scaleLinear()
		.range([0, width]);
	var xAxis = rangeSVG.append("g")
		.attr("class", "X_axis");
	
	
	//y axis
	var y = d3.scaleLinear()
		.range([height, 0]);
	var yAxis = rangeSVG.append("g")
		.attr("class", "Y_axis");
	
	//update method; input is going to be based on a slider in km
	function updateRangeChart(minimumRange) {
	
		//get json data & process inside function
		//console.log("min " + minimumRange);
		
		d3.json(dataURL, function(data) {
			//console.log(data);
			/*
				The json contains several layers
				
				First, there's the 293 vehicles in the "data" array read in from the json
				
				Also the 40 BRANDS in the "brands" array read in from the json
				
				there's also a "meta" array which just contains an update data and a count of vehicles in the dataset
			*/
			brands = data.brands
			vehicles = data.data
			maxRange = 0
			minUsableBattery = 0
			maxUsableBattery = 0
			minAvgEnergy = 0
			maxAvgEnergy = 0
			let remainingVehicles = [];
			for (let i = 0; i < vehicles.length; i++) {
				range = vehicles[i].usable_battery_size * (100 / vehicles[i].energy_consumption.average_consumption)
				
				if (range > maxRange) {
					maxRange = range
				}
				
				if (vehicles[i].usable_battery_size < minUsableBattery) {
					minUsableBattery = vehicles[i].usable_battery_size
				}
				
				if (vehicles[i].usable_battery_size > maxUsableBattery) {
					maxUsableBattery = vehicles[i].usable_battery_size
				}
				
				if (minAvgEnergy > vehicles[i].energy_consumption.average_consumption) {
					minAvgEnergy = vehicle[i].energy_consumption.average_consumption
				}
				
				if (maxAvgEnergy < vehicles[i].energy_consumption.average_consumption) {
					maxAvgEnergy = vehicles[i].energy_consumption.average_consumption
				}
				

			}
			console.log("minusable " + minUsableBattery)
			console.log("maxusable " + maxUsableBattery)
			console.log("minavg " + minAvgEnergy)
			console.log("maxavg " + maxAvgEnergy)
			

			//calculate range for all of the vehicles in the vehicles list
			//range (km) = usable_battery_size (kwH) * (100km / avg_energy_consumption (kwH/100km))
			// trust me I worked it out with the power of algebra
			
			//set up scatterplot using x axis data as usable_battery_size
			// y axis data as range?
			// or maybe x axis as usable_battery_size and y axis as average_consumption
			//and color by range, plus the filter on range anyway
			
			//x axis attribute changes; make the x axis go from 0 to the max
			
			
			
		
		})
	
	}
	
	d3.select("input[type=range]").on("change", function() {
		var min = d3.select(this).property("value")
		updateRangeChart(min)
	});
	
	updateRangeChart(0,1000)
		
	</script>

	</body>
	
</html>